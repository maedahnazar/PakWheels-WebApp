{% extends 'core/base.html' %}

{% block title %}{{ ad.title }} Details{% endblock %}

{% block extra_styles %}
<style>
    .ad-detail {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .ad-detail h1 {
        margin-top: 0;
    }

    .slider {
        position: relative;
        max-width: 100%;
        margin-bottom: 20px;
    }

    .slides {
        display: flex;
        overflow: hidden;
        width: 100%;
    }

    .slide {
        min-width: 100%;
        transition: transform 0.5s ease-in-out;
    }

    .slide img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
    }

    .arrow {
        position: absolute;
        top: 50%;
        width: 40px;
        height: 40px;
        background: rgba(0, 0, 0, 0.5);
        color: #fff;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: translateY(-50%);
    }

    .arrow.left {
        left: 10px;
    }

    .arrow.right {
        right: 10px;
    }

    .ad-detail h2 {
        margin-top: 0;
    }

    .ad-detail p {
        font-size: 1em;
        margin: 10px 0;
    }

    .ad-detail ul {
        list-style: none;
        padding: 0;
    }

    .ad-detail ul li {
        margin: 5px 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="ad-detail">
    <h1>{{ ad.title }}</h1>
    
    {% if ad.car %}
        {% if ad.car.images.exists %}
            <div class="slider">
                <div class="slides">
                    {% for image in ad.car.images.all %}
                        <div class="slide">
                            {% if image.external_image_url %}
                                <img src="{{ image.external_image_url }}" alt="{{ ad.title }}">
                            {% elif image.uploaded_image %}
                                <img src="{{ image.uploaded_image.url }}" alt="{{ ad.title }}">
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
                <button class="arrow left" onclick="moveSlide(-1)">&#10094;</button>
                <button class="arrow right" onclick="moveSlide(1)">&#10095;</button>
            </div>
        {% endif %}
        <h2>Car Details</h2>
        <p><strong>Registered In:</strong> {{ ad.car.registered_in }}</p>
        <p><strong>Color:</strong> {{ ad.car.color }}</p>
        <p><strong>Assembly:</strong> {{ ad.car.assembly }}</p>
        <p><strong>Engine Capacity:</strong> {{ ad.car.engine_capacity }} cc</p>
        <p><strong>Body Type:</strong> {{ ad.car.body_type }}</p>

        <h2>Car Features</h2>
        <ul>
            {% for feature in ad.car.features.all %}
                <li>{{ feature.name }}</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No car details available for this ad.</p>
    {% endif %}

    <h2>Inspection Report</h2>
    {% if car.inspection_reports.first %}
        <p><strong>Inspected Date:</strong> {{ car.inspection_reports.first.inspected_date }}</p>
        <p><strong>Overall Rating:</strong> {{ car.inspection_reports.first.overall_rating }}</p>
        <p><strong>Grade:</strong> {{ car.inspection_reports.first.grade }}</p>
        <p><strong>Exterior & Body:</strong> {{ car.inspection_reports.first.exterior_body }}</p>
        <p><strong>Engine/Transmission/Clutch:</strong> {{ car.inspection_reports.first.engine_transmission_clutch }}</p>
        <p><strong>Suspension/Steering:</strong> {{ car.inspection_reports.first.suspension_steering }}</p>
        <p><strong>Interior:</strong> {{ car.inspection_reports.first.interior }}</p>
        <p><strong>AC/Heater:</strong> {{ car.inspection_reports.first.ac_heater }}</p>
    {% else %}
        <p>No inspection report available for this car.</p>
    {% endif %}

    <p><strong>Price:</strong> {{ ad.price }} lacs</p>
    <p><strong>Location:</strong> {{ ad.location }}</p>
    <p><strong>Seller Comments:</strong> {{ ad.seller_comments|linebreaksbr }}</p>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    let slideIndex = 0;
    function showSlides() {
        const slides = document.querySelectorAll('.slide');
        slides.forEach((slide, index) => {
            slide.style.transform = `translateX(-${slideIndex * 100}%)`;
        });
    }
    function moveSlide(step) {
        const slides = document.querySelectorAll('.slide');
        slideIndex = (slideIndex + step + slides.length) % slides.length;
        showSlides();
    }
    showSlides(); 
</script>
{% endblock %}
